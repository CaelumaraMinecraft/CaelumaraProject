plugins {
    id("java-library")
    alias(libs.plugins.kotlin)
    alias(libs.plugins.shadow)
}

group = "top.auspice.bungee"

dependencies {
    // 向外传递 API
    api(project(":base"))

    // 向下传递依赖项
    api(project(":core"))

    compileOnly(libs.server.bungee)
    compileOnly(libs.adventure.platform.bungee) {
        exclude(module: "adventure-bom")
        exclude(module: "adventure-api")
        exclude(module: "adventure-nbt")
    }

    compileOnly(libs.adventure.text.bungee)

//    compileOnly("com.imaginarycode.minecraft:RedisBungee:0.4")
    compileOnly(libs.annotations.jetbrains)
}

shadowJar {
    archiveFileName = "Auspice-Bungee"

    dependencies {
        include(dependency('me.lucko.luckperms:.*'))
    }

    relocate 'net.kyori.adventure', 'top.auspice.libs.adventure'
    relocate 'net.kyori.event', 'top.auspice.libs.eventbus'
    relocate 'com.github.benmanes.caffeine', 'top.auspice.libs.caffeine'
    relocate 'okio', 'top.auspice.libs.okio'
    relocate 'okhttp3', 'top.auspice.libs.okhttp3'
    relocate 'net.bytebuddy', 'top.auspice.libs.bytebuddy'
    relocate 'me.lucko.commodore', 'top.auspice.libs.commodore'
    relocate 'org.mariadb.jdbc', 'top.auspice.libs.mariadb'
    relocate 'com.mysql', 'top.auspice.libs.mysql'
    relocate 'org.postgresql', 'top.auspice.libs.postgresql'
    relocate 'com.zaxxer.hikari', 'top.auspice.libs.hikari'
    relocate 'com.mongodb', 'top.auspice.libs.mongodb'
    relocate 'org.bson', 'top.auspice.libs.bson'
    relocate 'redis.clients.jedis', 'top.auspice.libs.jedis'
    relocate 'io.nats.client', 'top.auspice.libs.nats'
    relocate 'com.rabbitmq', 'top.auspice.libs.rabbitmq'
    relocate 'org.apache.commons.pool2', 'top.auspice.libs.commonspool2'
    relocate 'ninja.leaping.configurate', 'top.auspice.libs.configurate'
}

artifacts {
    archives shadowJar
}
